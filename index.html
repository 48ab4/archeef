<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Google Drive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 50%, #fbbc05 100%);
        }
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .upload-area {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #4285f4;
            background-color: #f8faff;
        }
        .upload-area.dragover {
            border-color: #4285f4;
            background-color: #e3f2fd;
            transform: scale(1.02);
        }
        .file-item {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .success-animation {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="mb-4">
                <svg class="w-20 h-20 mx-auto text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/>
                </svg>
            </div>
            <h1 class="text-5xl font-bold text-white mb-4">Ù…Ø¯ÙŠØ± Google Drive</h1>
            <p class="text-xl text-white opacity-90">Ø§Ø±ÙØ¹ ÙˆØ£Ø¯Ø± Ù…Ù„ÙØ§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto bg-white rounded-3xl card-shadow p-8">
            <!-- Connection Status -->
            <div id="connectionStatus" class="mb-8 p-6 rounded-2xl bg-gray-50 text-center border-2 border-gray-200">
                <div class="flex items-center justify-center mb-3">
                    <div id="statusIndicator" class="w-4 h-4 bg-red-500 rounded-full ml-3 animate-pulse"></div>
                    <span id="statusText" class="font-bold text-lg text-gray-700">ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Google Drive</span>
                </div>
                <p id="statusDescription" class="text-gray-600">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>

            <!-- Connect Button -->
            <div class="text-center mb-8">
                <button id="connectBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-12 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl text-lg">
                    <svg class="w-7 h-7 inline-block ml-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/>
                    </svg>
                    Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Drive
                </button>
            </div>

            <!-- Upload Section -->
            <div id="uploadSection" class="opacity-30 pointer-events-none transition-all duration-500">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
                
                <!-- Drag & Drop Area -->
                <div id="uploadArea" class="upload-area rounded-2xl p-12 text-center mb-8 cursor-pointer">
                    <div class="mb-6">
                        <svg class="w-24 h-24 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-700 mb-3">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§</h3>
                    <p class="text-gray-500 mb-6 text-lg">Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
                    <input type="file" id="fileInput" multiple class="hidden">
                    <button id="selectBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-xl transition-all duration-300 text-lg">
                        <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
                    </button>
                </div>

                <!-- Upload Progress -->
                <div id="uploadProgress" class="hidden mb-8">
                    <div class="bg-gray-200 rounded-full h-4 mb-3 overflow-hidden">
                        <div id="progressBar" class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-500 shadow-sm" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <p id="progressText" class="text-sm text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...</p>
                        <p id="progressPercent" class="text-sm font-bold text-green-600">0%</p>
                    </div>
                </div>

                <!-- Upload Button -->
                <div class="text-center mb-8">
                    <button id="uploadBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-12 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-lg" disabled>
                        <svg class="w-6 h-6 inline-block ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        Ø±ÙØ¹ Ø¥Ù„Ù‰ Google Drive
                    </button>
                </div>
            </div>

            <!-- Files List -->
            <div id="filesList" class="hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</h3>
                <div id="filesContainer" class="space-y-3 max-h-60 overflow-y-auto"></div>
                <div class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
                    <p class="text-blue-800 font-semibold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª: <span id="totalFiles">0</span></p>
                    <p class="text-blue-700">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalSize">0 KB</span></p>
                </div>
            </div>

            <!-- Configuration Status -->
            <div class="mt-8 p-6 bg-green-50 border-2 border-green-200 rounded-2xl">
                <div class="flex items-start">
                    <svg class="w-6 h-6 text-green-600 ml-3 mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <div>
                        <p class="font-bold text-green-800 mb-2">âœ… ØªÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!</p>
                        <p class="text-green-700 mb-3">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù†. ØªØ£ÙƒØ¯ Ù…Ù†:</p>
                        <ul class="text-green-700 space-y-1 text-sm">
                            <li>â€¢ âœ… <strong>Client ID:</strong> ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­</li>
                            <li>â€¢ âœ… <strong>API Key:</strong> ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­</li>
                            <li>â€¢ âœ… <strong>Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> https://48ab4.github.io</li>
                            <li>â€¢ âš ï¸ <strong>Drive API:</strong> ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„Ù‡ ÙÙŠ Google Cloud Console</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-blue-800 text-sm font-semibold">ğŸ”§ Ø®Ø·ÙˆØ© Ù…Ù‡Ù…Ø©:</p>
                            <p class="text-blue-700 text-sm mb-2">ÙÙŠ Google Cloud ConsoleØŒ Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø¥Ù„Ù‰ "Authorized JavaScript origins":</p>
                            <div class="bg-white p-2 rounded border border-blue-300 font-mono text-sm text-blue-900">
                                https://48ab4.github.io
                            </div>
                            <p class="text-blue-600 text-xs mt-2">Ø¨Ø¯ÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ù„Ù† ÙŠØ¹Ù…Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Drive API =====
        // ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù…Ù† Google Cloud Console
        const CLIENT_ID = '883555732132-kktvprdnoh95l05e7gdfo58g3ths4api.apps.googleusercontent.com'; // Client ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const API_KEY = 'AIzaSyBTYQ93RUBmgvOZjw0B3dGI0cQlDEu1z3I'; // API Key Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // ===== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
        let gapi;
        let isConnected = false;
        let selectedFiles = [];
        let tokenClient;

        // ===== Ø¹Ù†Ø§ØµØ± DOM =====
        const connectBtn = document.getElementById('connectBtn');
        const uploadSection = document.getElementById('uploadSection');
        const connectionStatus = document.getElementById('connectionStatus');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const statusDescription = document.getElementById('statusDescription');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const selectBtn = document.getElementById('selectBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const filesList = document.getElementById('filesList');
        const filesContainer = document.getElementById('filesContainer');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');
        const totalFiles = document.getElementById('totalFiles');
        const totalSize = document.getElementById('totalSize');

        // ===== ØªÙ‡ÙŠØ¦Ø© Google API =====
        async function initializeGapi() {
            try {
                await new Promise((resolve, reject) => {
                    gapi.load('client:auth2', resolve);
                });

                await gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: [DISCOVERY_DOC],
                    scope: SCOPES
                });

                console.log('Google API initialized successfully');
                return true;
            } catch (error) {
                console.error('Error initializing Google API:', error);
                showError('ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Google API. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.');
                return false;
            }
        }

        // ===== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Drive =====
        connectBtn.addEventListener('click', async function() {
            if (CLIENT_ID === 'YOUR_CLIENT_ID_HERE' || API_KEY === 'YOUR_API_KEY_HERE') {
                showError('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Client ID Ùˆ API Key ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            connectBtn.innerHTML = '<svg class="w-6 h-6 inline-block ml-3 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...';
            connectBtn.disabled = true;

            try {
                const initialized = await initializeGapi();
                if (!initialized) return;

                // Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                const authInstance = gapi.auth2.getAuthInstance();
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                const signInOptions = {
                    prompt: 'select_account' // ÙŠØ¬Ø¨Ø± Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                };
                
                const user = await authInstance.signIn(signInOptions);
                
                if (user.isSignedIn()) {
                    const profile = user.getBasicProfile();
                    const userEmail = profile.getEmail();
                    const userName = profile.getName();
                    const userImage = profile.getImageUrl();
                    
                    isConnected = true;
                    updateConnectionStatus(true, userName, userEmail, userImage);
                    enableUploadSection();
                    
                    connectBtn.innerHTML = '<svg class="w-6 h-6 inline-block ml-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    connectBtn.className = 'bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-12 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl text-lg';
                }
            } catch (error) {
                console.error('Connection error:', error);
                showError('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Drive');
                connectBtn.innerHTML = '<svg class="w-7 h-7 inline-block ml-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Drive';
                connectBtn.disabled = false;
            }
        });

        // ===== ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ =====
        function updateConnectionStatus(connected, userName = '', userEmail = '', userImage = '') {
            if (connected) {
                statusIndicator.className = 'w-4 h-4 bg-green-500 rounded-full ml-3';
                statusText.textContent = 'Ù…ØªØµÙ„ Ø¨Ù€ Google Drive';
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                statusDescription.innerHTML = `
                    <div class="flex items-center justify-center mt-3">
                        <img src="${userImage}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-10 h-10 rounded-full ml-3 border-2 border-green-300">
                        <div class="text-right">
                            <p class="font-bold text-green-800">${userName}</p>
                            <p class="text-sm text-green-600">${userEmail}</p>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button id="switchAccountBtn" class="text-blue-600 hover:text-blue-800 underline text-sm font-semibold transition-colors">
                            ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                        </button>
                    </div>
                `;
                connectionStatus.className = 'mb-8 p-6 rounded-2xl bg-green-50 text-center border-2 border-green-200';
                
                // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                setTimeout(() => {
                    const switchBtn = document.getElementById('switchAccountBtn');
                    if (switchBtn) {
                        switchBtn.addEventListener('click', switchAccount);
                    }
                }, 100);
                
            } else {
                statusIndicator.className = 'w-4 h-4 bg-red-500 rounded-full ml-3 animate-pulse';
                statusText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Google Drive';
                statusDescription.textContent = 'Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø¨Ø¯Ø¡';
                connectionStatus.className = 'mb-8 p-6 rounded-2xl bg-gray-50 text-center border-2 border-gray-200';
            }
        }

        // ===== ØªÙØ¹ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø±ÙØ¹ =====
        function enableUploadSection() {
            uploadSection.classList.remove('opacity-30', 'pointer-events-none');
            uploadSection.classList.add('opacity-100');
        }

        // ===== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ =====
        async function switchAccount() {
            try {
                const authInstance = gapi.auth2.getAuthInstance();
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
                await authInstance.signOut();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
                isConnected = false;
                updateConnectionStatus(false);
                uploadSection.classList.add('opacity-30', 'pointer-events-none');
                uploadSection.classList.remove('opacity-100');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                connectBtn.innerHTML = '<svg class="w-7 h-7 inline-block ml-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Drive';
                connectBtn.className = 'bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-12 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl text-lg';
                connectBtn.disabled = false;
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                resetForm();
                
                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø®ØªÙŠØ§Ø± Ø­Ø³Ø§Ø¨ Ø¢Ø®Ø±.');
                
            } catch (error) {
                console.error('Switch account error:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨');
            }
        }

        // ===== Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª =====
        selectBtn.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('click', (e) => {
            if (e.target === uploadArea || e.target.closest('#uploadArea')) {
                fileInput.click();
            }
        });

        fileInput.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        // ===== Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª =====
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            if (!uploadArea.contains(e.relatedTarget)) {
                uploadArea.classList.remove('dragover');
            }
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        // ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª =====
        function handleFiles(files) {
            selectedFiles = Array.from(files);
            displayFiles();
            updateUploadButton();
        }

        function displayFiles() {
            if (selectedFiles.length > 0) {
                filesList.classList.remove('hidden');
                filesContainer.innerHTML = '';
                
                let totalSizeBytes = 0;
                
                selectedFiles.forEach((file, index) => {
                    totalSizeBytes += file.size;
                    
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200 hover:bg-gray-100 transition-colors';
                    fileItem.innerHTML = `
                        <div class="flex items-center flex-1">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center ml-4">
                                ${getFileIcon(file.type)}
                            </div>
                            <div class="flex-1">
                                <p class="font-bold text-gray-800 truncate">${file.name}</p>
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
                                    <p class="text-sm text-gray-500">${file.type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                </div>
                            </div>
                        </div>
                        <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    `;
                    filesContainer.appendChild(fileItem);
                });
                
                totalFiles.textContent = selectedFiles.length;
                totalSize.textContent = formatFileSize(totalSizeBytes);
            } else {
                filesList.classList.add('hidden');
            }
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displayFiles();
            updateUploadButton();
        }

        function updateUploadButton() {
            uploadBtn.disabled = selectedFiles.length === 0 || !isConnected;
        }

        // ===== Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª =====
        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) {
                return '<svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg>';
            } else if (fileType.startsWith('video/')) {
                return '<svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm3 2h6v4l2-2v6l-2-2v4H7V5z" clip-rule="evenodd"></path></svg>';
            } else if (fileType.includes('pdf')) {
                return '<svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>';
            } else {
                return '<svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>';
            }
        }

        // ===== ØªÙ†Ø³ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù =====
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ===== Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª =====
        uploadBtn.addEventListener('click', async function() {
            if (!isConnected || selectedFiles.length === 0) return;

            uploadProgress.classList.remove('hidden');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<svg class="w-6 h-6 inline-block ml-3 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

            try {
                let uploadedCount = 0;
                const totalFiles = selectedFiles.length;

                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    await uploadFileToGoogleDrive(file);
                    
                    uploadedCount++;
                    const progress = (uploadedCount / totalFiles) * 100;
                    
                    progressBar.style.width = progress + '%';
                    progressPercent.textContent = Math.round(progress) + '%';
                    progressText.textContent = `ØªÙ… Ø±ÙØ¹ ${uploadedCount} Ù…Ù† ${totalFiles} Ù…Ù„Ù`;
                }

                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                showSuccess(`ØªÙ… Ø±ÙØ¹ ${totalFiles} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Google Drive!`);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                resetForm();

            } catch (error) {
                console.error('Upload error:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª');
            } finally {
                uploadProgress.classList.add('hidden');
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<svg class="w-6 h-6 inline-block ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>Ø±ÙØ¹ Ø¥Ù„Ù‰ Google Drive';
            }
        });

        // ===== Ø±ÙØ¹ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø¥Ù„Ù‰ Google Drive =====
        async function uploadFileToGoogleDrive(file) {
            return new Promise((resolve, reject) => {
                const metadata = {
                    'name': file.name,
                    'parents': ['root'] // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ù…Ø­Ø¯Ø¯
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
                form.append('file', file);

                fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({
                        'Authorization': `Bearer ${gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token}`
                    }),
                    body: form
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        reject(data.error);
                    } else {
                        resolve(data);
                    }
                })
                .catch(error => reject(error));
            });
        }

        // ===== Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ =====
        function resetForm() {
            selectedFiles = [];
            fileInput.value = '';
            displayFiles();
            updateUploadButton();
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
        }

        // ===== Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„Ø®Ø·Ø£ =====
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-8 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl z-50 success-animation';
            successDiv.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-6 h-6 ml-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="font-bold">${message}</span>
                </div>
            `;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-8 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-8 py-4 rounded-2xl shadow-2xl z-50';
            errorDiv.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-6 h-6 ml-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="font-bold">${message}</span>
                </div>
            `;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© =====
        window.addEventListener('load', function() {
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Google API
            if (typeof gapi === 'undefined') {
                showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Google API');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b8f3ae20f2f9eb',t:'MTc1NDU5MjU0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
