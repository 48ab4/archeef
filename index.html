<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ربط جوجل درايف</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      direction: rtl;
      background-color: #f8fafc;
      padding: 2rem;
      text-align: center;
    }
    .btn {
      background-color: #2563eb;
      color: white;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-size: 1.2rem;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn:hover {
      background-color: #1e40af;
    }
    .status {
      margin-top: 1rem;
      font-size: 1rem;
      color: #15803d;
    }
  </style>
</head>
<body>

  <h1>🔗 ربط حسابك مع Google Drive</h1>
  <button id="connectBtn" class="btn">تسجيل الدخول باستخدام Google</button>

  <div id="status" class="status"></div>

  <script>
    const CLIENT_ID = '883555732132-kktvprdnoh95l05e7gdfo58g3ths4api.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBTYQ93RUBmgvOZjw0B3dGI0cQlDEu1z3I';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';

    let isConnected = false;

    document.getElementById('connectBtn').addEventListener('click', () => {
      gapi.load('client:auth2', initClient);
    });

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
        scope: SCOPES
      }).then(() => {
        const authInstance = gapi.auth2.getAuthInstance();
        
        // فرض اختيار الحساب دائمًا
        authInstance.signIn({ prompt: 'select_account' }).then(() => {
          const user = authInstance.currentUser.get();
          const profile = user.getBasicProfile();
          const email = profile.getEmail();

          isConnected = true;
          document.getElementById('status').innerHTML = `✅ تم الاتصال بحساب: <strong>${email}</strong>`;
          document.getElementById('connectBtn').innerText = '✅ متصل بجوجل درايف';
          document.getElementById('connectBtn').disabled = true;
        }).catch((error) => {
          console.error('خطأ في تسجيل الدخول:', error);
          document.getElementById('status').innerText = '❌ حدث خطأ أثناء الاتصال بحساب Google.';
        });
      });
    }
  </script>

</body>
</html>
